const express = require('express');
const app = express();
const { Pool } = require('pg');

// データベース接続設定
const pool = new Pool({
  connectionString: 'postgres://user:password@localhost:5432/dbname',
});

// キーワードを含むタイトルを検索するエンドポイント
app.get('/search_keywords', async (req, res) => {
    const { token, keyword } = req.query;
    try {
        const result = await pool.query(
            `SELECT title FROM wiki_pages_f7095a
             WHERE token = $1 AND content LIKE '%[' || $2 || ']%'
             ORDER BY updated_at DESC`,
            [token, keyword]
        );
        const titles = result.rows.map(row => row.title);
        res.json({ status: 'success', titles });
    } catch (err) {
        console.error(err);
        res.status(500).json({ status: 'error', message: 'Internal server error' });
    }
});

// その他のエンドポイント（/load, /get_titles, /load_last）も同様に実装
